<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="generator" content="HTML Tidy for Linux (vers 7 December 2008), see www.w3.org"/>
<meta http-equiv="CONTENT-TYPE" content="text/html; charset=utf-8"/>

<meta name="GENERATOR" content="OpenOffice.org 3.0 (Unix)"/>
<meta name="CREATED" content="20151109;11564100"/>
<meta name="CHANGED" content="20151129;1342700"/>
<meta name="Info_1" content=""/>
<meta name="Info_2" content=""/>
<meta name="Info_3" content=""/>
<meta name="Info_4" content=""/>
<title>Essential Python</title>
<meta content="http://www.w3.org/1999/xhtml; charset=utf-8" http-equiv="Content-Type"/><link href="stylesheet.css" type="text/css" rel="stylesheet"/><style type="text/css">
		@page { margin-bottom: 5.000000pt; margin-top: 5.000000pt; }</style></head>
<body dir="ltr" class="calibre">
<h1 lang="en-GB" class="western3" id="calibre_pb_20"><a id="Databases"></a> 22.
Databases</h1>
<p lang="en-GB" class="western">Databases are used for all sorts
of things, the ability to connect with a database and write code to
manipulate the data or extract data from the database is extremely
powerful.</p>
<p lang="en-GB" class="western">While Python can connect to most
databases this often requires additional libraries to be installed
to allow connection, once connected however the database will often
be accessed with SQL commands. SQL this is a standard language used
by most databases and allows for construction, adding, deleting
records and querying of databases.</p>
<p lang="en-GB" class="western">Python comes with SQLite so this
will be used in this chapter to demonstrate how to access a
database. This is a light weight database and is probably better
suited to development rather than to implementing a large scale
database where a more powerful database such as MySQL should be
considered.</p>
<h2 lang="en-GB" class="western4">SQL</h2>
<p lang="en-GB" class="western">This book is about Python not
SQL but since the you will need an overview of some of the commands
to understand the Python code. SQL stands for structured query
language and is used by most databases.</p>
<p lang="en-GB" class="western">A database is built up of tables
containing records (rows), each record consists of a set of fields
(columns) containing the database information.</p>
<p lang="en-GB" class="western">So a simple table for an album
collection might contain the following fields key, band, album and
price so the data could be.</p>
<p lang="en-GB" class="western">0, Dio, Last in Line, 5.65</p>
<p lang="en-GB" class="western">1, Faith No More, Angel Dust,
6.65</p>
<p lang="en-GB" class="western">2, Marillion, Fugazi, 7.65</p>
<p lang="en-GB" class="western">Note the first row contains a
key this is a unique identify for the row (record), although not
necessarily required it is good practice to have a key field, no
two records should have the same key by following this rule it
means that each record is unique in some way.</p>
<p lang="en-GB" class="western">A table is created using the
CREATE TABLE command, for the above table the required SQL would
be</p>
<p lang="en-GB" class="c5"><span class="c6">CREATE TABLE Albums(
id INTEGER PRIMARY KEY, band TEXT, album TEXT, price
REAL)</span></p>
<p lang="en-GB" class="western">The command is fairly self
explanatory it creates a table with 4 fields. The first field is
called id and contains integer data and is the primary key for the
table this means that the information entered into this field needs
to be unique or it will be rejected. The next two fields are text
fields and the final field is a real number (float).</p>
<p lang="en-GB" class="western">SQLite supports the following
data types, INTEGER, stored in 1 to 8 bytes dependant on the value,
REAL 8 byte IEEE float, TEXT and BLOB which can be used for storing
binary data.</p>
<p lang="en-GB" class="western">Once the table is defined rows
can be added into the table this is done with the insert
command.</p>
<p lang="en-GB" class="c5"><span class="c6">INSERT INTO Albums
VALUES ( 0 , 'Dio' , 'Last in Line' , '5.65')</span></p>
<p lang="en-GB" class="western">The command adds the record
defined to the database.</p>
<p lang="en-GB" class="western">To extract data from the
database the SELECT command is used</p>
<p lang="en-GB" class="c5"><span class="c6">SELECT id, band, album
FROM Albums</span></p>
<p lang="en-GB" class="western">This will extract the id, band
and album fields from the albums table, more complicated select
commands can be made up using the WHERE command as follows.</p>
<p lang="en-GB" class="c5"><span class="c6">SELECT id, band, album
FROM Albums WHERE price &gt;= 7.00</span></p>
<p lang="en-GB" class="western">This example will get all the
records where price is greater than 7.00.</p>
<p lang="en-GB" class="western">To use the SQLite database the
Pyhton needs to connect to the database and then a cursor object is
used to send the SQL commands.</p>
<p lang="en-GB" class="c5"><span class="c6"># file:
dataBase.py</span></p>
<p lang="en-GB" class="c5"><span class="c6">#
1/usr/bi/python</span></p>
<p lang="en-GB" class="c5"><span class="c6">import
sqlite3</span></p>
<p lang="en-GB" class="c7"> <br class="calibre1"/></p>
<p lang="en-GB" class="c5"><span class="c6">__author__ =
'Essential Python'</span></p>
<p lang="en-GB" class="c7"> <br class="calibre1"/></p>
<p lang="en-GB" class="c5"><span class="c6"># create the
database</span></p>
<p lang="en-GB" class="c5"><span class="c6">connection =
sqlite3.connect("AlbumInventory.db")</span></p>
<p lang="en-GB" class="c5"><span class="c6">cursor =
connection.cursor()</span></p>
<p lang="en-GB" class="c7"> <br class="calibre1"/></p>
<p lang="en-GB" class="c5"><span class="c6"># add some
records</span></p>
<p lang="en-GB" class="c5"><span class="c6">cursor.execute("CREATE
TABLE Albums( id INTEGER PRIMARY KEY, band TEXT, album TEXT, price
REAL)")</span></p>
<p lang="en-GB" class="c5"><span class="c6">cursor.execute("INSERT
INTO Albums VALUES ( 0 , 'Dio' , 'Last in Line' , '5.65')
")</span></p>
<p lang="en-GB" class="c5"><span class="c6">cursor.execute("INSERT
INTO Albums VALUES ( 1 , 'Faith No More' , 'Angel Dust' , '6.65')
")</span></p>
<p lang="en-GB" class="c5"><span class="c6">cursor.execute("INSERT
INTO Albums VALUES ( 2 , 'Marillion' , 'Fugazi' , '7.65')
")</span></p>
<p lang="en-GB" class="c7"> <br class="calibre1"/></p>
<p lang="en-GB" class="c5"><span class="c6"># Write data to
database</span></p>
<p lang="en-GB" class="c5"><span class="c6">connection.commit()</span></p>
<p lang="en-GB" class="c7"> <br class="calibre1"/></p>
<p lang="en-GB" class="c5"><span class="c6"># read data from the
database</span></p>
<p lang="en-GB" class="c5"><span class="c6">cursor.execute("SELECT
id, band, album FROM Albums ")</span></p>
<p lang="en-GB" class="c5"><span class="c6">result =
cursor.fetchall()</span></p>
<p lang="en-GB" class="c5"><span class="c6">for rec in
result:</span></p>
<p lang="en-GB" class="c5"><span class="c6">key, band, album =
rec</span></p>
<p lang="en-GB" class="c5"><span class="c6">print(key, " - ",
band, " - ", album)</span></p>
<p lang="en-GB" class="c7"> <br class="calibre1"/></p>
<p lang="en-GB" class="c5"><span class="c6"># read records where
the price &gt; 7.00</span></p>
<p lang="en-GB" class="c5"><span class="c6">cursor.execute("SELECT
id, band, album FROM Albums WHERE price &gt;= 7.00")</span></p>
<p lang="en-GB" class="c5"><span class="c6">result =
cursor.fetchall()</span></p>
<p lang="en-GB" class="c5"><span class="c6">for rec in
result:</span></p>
<p lang="en-GB" class="c5"><span class="c6">key, band, album =
rec</span></p>
<p lang="en-GB" class="c5"><span class="c6">print(key, " - ",
band, " - ", album)</span></p>
<p lang="en-GB" class="c7"> <br class="calibre1"/></p>
<p lang="en-GB" class="c5"><span class="c6"># close the
database</span></p>
<p lang="en-GB" class="c5"><span class="c6">cursor.close()</span></p>
<p lang="en-GB" class="western">The above example creates the
database and gets the cursor.</p>
<p lang="en-GB" class="c5"><span class="c6">connection =
sqlite3.connect("AlbumInventory.db")</span></p>
<p lang="en-GB" class="c5"><span class="c6">cursor =
connection.cursor()</span></p>
<p lang="en-GB" class="western">The table is then created and
three records are then added to the table. The data is then written
to the database with the commit method.</p>
<p lang="en-GB" class="western">The execute method is then used
to interrogate the database and read the records, which are then
displayed. Finally the database connection is closed with the close
method.</p>
<p lang="en-GB" class="western">If you want to use the SQLite
database but don't need it to be saved then you can run the
database in memory by changing the connect command to.</p>
<p lang="en-GB" class="c5"><span class="c6">connection =
sqlite3.connect(":memory:")</span></p>
<p lang="en-GB" class="western"><br class="calibre1"/>
<br class="calibre1"/></p>
<p lang="en-GB" class="western"><br class="calibre1"/>
<br class="calibre1"/></p>
<p lang="en-GB" class="western"><br class="calibre1"/>
<br class="calibre1"/></p>
<p lang="en-GB" class="western"><br class="calibre1"/>
<br class="calibre1"/></p>
</body>
</html>
